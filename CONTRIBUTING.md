# Contribution Guide

Thank you for taking the time to improve D&D Cards! This guide summarizes the
workflow, requirements, and best practices adopted in the repository.

## Summary

- [Contribution Guide](#contribution-guide)
  - [Summary](#summary)
  - [Code of Conduct](#code-of-conduct)
  - [Overview](#overview)
  - [Local Environment](#local-environment)
    - [Prerequisites](#prerequisites)
    - [Setup](#setup)
    - [Useful Scripts](#useful-scripts)
  - [Contribution Flow](#contribution-flow)
    - [Issues](#issues)
    - [Branches](#branches)
    - [Commits](#commits)
    - [Before opening a PR](#before-opening-a-pr)
    - [Pull Request](#pull-request)
  - [Code Guidelines](#code-guidelines)
  - [Data, i18n, and Printing](#data-i18n-and-printing)
  - [Documentation Standards](#documentation-standards)
  - [Acknowledgment](#acknowledgment)

## Code of Conduct

All participation must follow the **[CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md)**.
Conduct reports can be submitted through the channels described there or via
**[jp.coutm@gmail.com](mailto:jp.coutm@gmail.com)**.

## Overview

- Open an Issue before starting major changes (new features, extensive
  refactorings, massive data). This helps align scope and avoids duplicate work.
- Small, frequent PRs are preferred. If the task grows, break it into smaller
  deliverables.
- Whenever possible, add captures (*before/after*) for visual changes.

## Local Environment

### Prerequisites

- Node.js **20.x** or newer, supported by Vite 7.
- npm **10.x** (recommended). If using npm/yarn, convert commands locally and
  only commit files generated by `npm`.
- A modern browser for manual validation.

### Setup

```bash
git clone https://github.com/<org>/dnd-cards.git
cd dnd-cards
npm ci
npm run dev
```

Vite starts at `http://localhost:5173`. Adjustments to `src/` reload
automatically.

### Useful Scripts

- `npm run dev` – environment with hot reload.
- `npm run build` – production build (equivalent to Vite + TypeScript
  validation).
- `npm run preview` – serve `dist/` respecting `base=/dnd-cards`; use
  `npm run preview -- --host` to test on a local network.
- `npm run lint` – lint TypeScript/JSX (ESLint 9 with React configs + a11y).

## Contribution Flow

### Issues

- Prefer the appropriate template: **Bug report** or **Feature request**.
- Describe the objective, impact, and a simple **Definition of Done** (DoD).
- Mention external dependencies (SRD data, translations, etc.) when relevant.

### Branches

- Create the branch from `main`.
- Suggested conventions:
  - `feature/<scope>-<slug>`
  - `fix/<scope>-<slug>`
  - `cry/<scope>-<slug>`
  - `hotfix/<slug>` (reserved for maintainers).
- Scope examples: `pages/browse`, `components/card`, `lib/search`, `data/spells`,
  `styles/print`, `build`, `docs`.

### Commits

- Use **Conventional Commits**:
  - `feat(search): add accent-insensitive filters`
  - `fix(print): prevent duplicated backs when density changes`
  - `docs: update security policy`
- Accepted types: `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`,
  `build`, `ci`, `chore`.
- Short, imperative messages focused on one change per commit. Avoid huge, mixed
  commits.

### Before opening a PR

1. **Synchronize** with `main` (short rebase or merge).
1. Run:

   ```bash
   npm ci
   npm run lint
   npm run build
   ```

1. Perform smoke tests:
   - General navigation, language/theme change, and visible focus.
   - Card selection/removal + page reload.
   - Print Preview (densities, columns, back, reorder) and PDF printing.
   - If you changed data or schema, validate extreme inputs.
1. Update screenshots in the PR when there are UI changes.
1. Check that documentation and changelog are aligned (when applicable).

## Pull Request

- Open the PR against `main` and fill out the standard template.
- Minimum checklist:
  - [ ] Issue/DoD referenced
  - [ ] `npm run lint` and `npm run build` executed
  - [ ] Manual accessibility (focus, contrast, readers) checked
  - [ ] PT/EN reviewed
  - [ ] Persistence (packs) validated
  - [ ] Print Preview tested (S/M/L + back)
  - [ ] Data/schema/documentation updated (when applicable)
- We prefer **Squash & Merge** after review.
- Use `git rebase origin/main` and `git push --force-with-lease` to keep the
  history clean.

## Code Guidelines

- Code and comments in **English** (exception: copy displayed to the user).
- Avoid `any` and prefer types defined in schemas (`TSpell`, `TFeature`).
- Custom hooks are located in `lib/` or under specific directories; compose
  rather than duplicate logic.
- Components should remain “presentational” whenever possible; delegate logic to
  hooks/utilities.
- Follow the adopted style (ESLint + Prettier implicit in Vite). Avoid divergent
  local configurations.
- Accessibility:
  - Preserve `aria-*`, `role`, `aria-live`, `tabIndex`, and managed focus.
  - Do not remove the *skip link* or change tokens without considering WCAG AA
    contrast.

## Data, i18n, and Printing

- **Data (SRD):**
  - Files in `src/data/srd/*.json` must pass `SpellsArray`/`FeaturesArray`
    validation.
  - Tag normalization occurs in `lib/search/tags.ts`; update if adding new tags.
  - Running `npm run build` detects errors early.
- **i18n:**
  - PT displays PT/EN side by side; EN displays only EN (see `Card.tsx` and
    `CardPrint.tsx`).
  - Dynamic strings reside close to the component; maintain key consistency.
  - Always test in both languages.
- **Printing:**
  - `print.css` controls dimensions; test changes with PDFs in different
    orientations and densities.
  - Reordering cards must not break IDs or generate duplicate entries.
  - Ensure trim marks and headers work in light/dark mode.
- **PWA/IndexedDB:**
  - Updates to the SW/manifest require `npm run build` plus testing in
    `npm run preview`.
  - `lib/db.ts` has a fallback to localStorage; do not remove it without an
    alternative.

## Documentation Standards

- Changes that affect users should be reflected in the **README**, **SECURITY**,
  **CONTRIBUTING**, or **RELEASE**, as applicable.
- Update the **CHANGELOG** in `## [Unreleased]` with short entries
  (Added/Changed/Fixed).
- Translations and interface copy should maintain consistency with the current
  tone.

## Acknowledgment

Accepted contributions are mentioned in the `CHANGELOG` and/or release notes.
Thank you for helping make D&D Cards better for the community!
